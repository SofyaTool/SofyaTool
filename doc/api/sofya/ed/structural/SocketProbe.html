<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.5.0_06) on Tue Aug 08 14:15:15 CDT 2006 -->
<TITLE>
SocketProbe (Sofya API Documentation)
</TITLE>

<META NAME="keywords" CONTENT="sofya.ed.structural.SocketProbe class">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    parent.document.title="SocketProbe (Sofya API Documentation)";
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../sofya/ed/structural/SequenceTraceWriter.html" title="class in sofya.ed.structural"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../sofya/ed/structural/SocketProcessingStrategy.html" title="interface in sofya.ed.structural"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html?sofya/ed/structural/SocketProbe.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="SocketProbe.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
sofya.ed.structural</FONT>
<BR>
Class SocketProbe</H2>
<PRE>
java.lang.Object
  <IMG SRC="../../../resources/inherit.gif" ALT="extended by "><B>sofya.ed.structural.SocketProbe</B>
</PRE>
<DL>
<DT><B>All Implemented Interfaces:</B> <DD>java.lang.Runnable, <A HREF="../../../sofya/base/SConstants.html" title="interface in sofya.base">SConstants</A></DD>
</DL>
<HR>
<DL>
<DT><PRE>public final class <B>SocketProbe</B><DT>extends java.lang.Object<DT>implements <A HREF="../../../sofya/base/SConstants.html" title="interface in sofya.base">SConstants</A>, java.lang.Runnable</DL>
</PRE>

<P>
The SocketProbe class is responsible for transmitting instrumentation trace
 statements from the subject to the event dispatcher. It is calls to methods
 implemented by this class which are actually inserted into subjects by the
 instrumentor.

 <p>This class establishes a persistent socket connection to the event
 dispatcher on a specified port and implements the instrumentation methods
 which send trace messages to the dispatcher over that socket. The
 instrumentor is responsible for inserting a call to the <code>start</code>
 method of this class as the first executable instruction of a subject class.
 This will create an instance of this class which has connected a socket to
 the dispatcher and is kept alive as a daemon thread.

 <p>To enable this mechanism to work with the greatest possible genericity,
 and to avoid naming and dynamic linking conflicts when an instrumented
 dispatcher is being run as a subject, this class is handled in a special
 fashion. When a dispatcher runs, it constructs a jar file which contains
 this class (among others) and prepends the jar file to the bootstrap
 classpath for the subject. Thus when a subject seeks to resolve a call to
 the static methods implemented by this class, the first definition of the
 class to be located by the class loader is the one provided on the bootstrap
 classpath, including when the subject is an instrumented dispatcher. However,
 since the bootstrap classpath contains no other Sofya related classes
 (except SConstants, which as an* interface contains no code, and is
 universally backwards compatible), all other subject classes will be found
 by the class loader in their expected locations on the subject's own
 classpath. Note that this also means that the SocketProbe runs inside the
 same JVM that is running the subject, so the fact that an instrumented
 dispatcher locates the shared SocketProbe before it locates its own is
 not problematic (it will however copy its own SocketProbe
 when constructing its own jar file for its subject).</p>

 <p>When the SocketProbe itself is instrumented, the instrumentor inserts
 special calls to methods of the same name in a class named SocketProbeAlt.
 That class is created dynamically by the invoking dispatcher at runtime, as a
 clone of its SocketProbe, and shared in the same manner. This permits the
 instrumented SocketProbe to call instrumentation methods that do not resolve
 to itself and cause infinite recursion.</p>

 <p>With this mechanism it is possible to create a chain of dispatchers
 executing other dispatchers as subjects, although intervention to set the
 ports correctly is required beyond the first subject dispatcher. This is
 likely only useful up to the second level of self analysis, as data
 obtained from further chaining is redundant. (The first level of sel
 analysis will provide trace information for the
 <A HREF="../../../sofya/ed/structural/SocketProcessingStrategy.html#processProbesSynchronized(java.net.Socket, sofya.ed.structural.ControlData)"><CODE>SocketProcessingStrategy.processProbesSynchronized(java.net.Socket, sofya.ed.structural.ControlData)</CODE></A> method
 and the second level of self analysis will provide trace information for
 <A HREF="../../../sofya/ed/structural/SocketProcessingStrategy.html#processProbes(java.net.Socket, sofya.ed.structural.ControlData)"><CODE>SocketProcessingStrategy.processProbes(java.net.Socket, sofya.ed.structural.ControlData)</CODE></A>).</p>
<P>

<P>
<DL>
<DT><B>Version:</B></DT>
  <DD>08/04/2006</DD>
<DT><B>Author:</B></DT>
  <DD>Alex Kinneer</DD>
<DT><B>See Also:</B><DD><A HREF="../../../sofya/ed/structural/ProgramEventDispatcher.html" title="class in sofya.ed.structural"><CODE>ProgramEventDispatcher</CODE></A>, 
<A HREF="../../../sofya/ed/cfInstrumentor.html" title="class in sofya.ed"><CODE>cfInstrumentor</CODE></A></DL>
<HR>

<P>
<!-- ======== NESTED CLASS SUMMARY ======== -->

<A NAME="nested_class_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Nested Class Summary</B></FONT></TH>
</TR>
</TABLE>
&nbsp;<A NAME="nested_classes_inherited_from_class_sofya.base.SConstants"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Nested classes/interfaces inherited from interface sofya.base.<A HREF="../../../sofya/base/SConstants.html" title="interface in sofya.base">SConstants</A></B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><A HREF="../../../sofya/base/SConstants.BlockLabel.html" title="class in sofya.base">SConstants.BlockLabel</A>, <A HREF="../../../sofya/base/SConstants.BlockObjectType.html" title="class in sofya.base">SConstants.BlockObjectType</A>, <A HREF="../../../sofya/base/SConstants.BlockSubType.html" title="class in sofya.base">SConstants.BlockSubType</A>, <A HREF="../../../sofya/base/SConstants.BlockType.html" title="class in sofya.base">SConstants.BlockType</A>, <A HREF="../../../sofya/base/SConstants.BranchObjectType.html" title="class in sofya.base">SConstants.BranchObjectType</A>, <A HREF="../../../sofya/base/SConstants.BranchType.html" title="class in sofya.base">SConstants.BranchType</A>, <A HREF="../../../sofya/base/SConstants.EDObjectType.html" title="class in sofya.base">SConstants.EDObjectType</A>, <A HREF="../../../sofya/base/SConstants.TraceObjectType.html" title="class in sofya.base">SConstants.TraceObjectType</A></CODE></TD>
</TR>
</TABLE>
&nbsp;
<!-- =========== FIELD SUMMARY =========== -->

<A NAME="field_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Field Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected static&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../sofya/ed/structural/SocketProbe.html#BRANCH_EXIT_MARKER">BRANCH_EXIT_MARKER</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Constant which marks in the sequence array that the current
        method is exiting.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected static&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../sofya/ed/structural/SocketProbe.html#NEW_METHOD_MARKER">NEW_METHOD_MARKER</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Constant which marks that the next element in the object
        sequence array contains the index to a new method signature.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;int[]</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../sofya/ed/structural/SocketProbe.html#sequenceArray">sequenceArray</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Array which stores the hit object IDs sequentially, using
        special marker/index pairs to indicate entry into new methods.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../sofya/ed/structural/SocketProbe.html#sequenceIndex">sequenceIndex</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Index pointing to the next open entry in the sequence array.</TD>
</TR>
</TABLE>
&nbsp;<A NAME="fields_inherited_from_class_sofya.base.SConstants"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Fields inherited from interface sofya.base.<A HREF="../../../sofya/base/SConstants.html" title="interface in sofya.base">SConstants</A></B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><A HREF="../../../sofya/base/SConstants.html#DEFAULT_PORT">DEFAULT_PORT</A>, <A HREF="../../../sofya/base/SConstants.html#INST_COMPATIBLE">INST_COMPATIBLE</A>, <A HREF="../../../sofya/base/SConstants.html#INST_OLD_UNSUPPORTED">INST_OLD_UNSUPPORTED</A>, <A HREF="../../../sofya/base/SConstants.html#INST_OPT_NORMAL">INST_OPT_NORMAL</A>, <A HREF="../../../sofya/base/SConstants.html#INST_OPT_SEQUENCE">INST_OPT_SEQUENCE</A>, <A HREF="../../../sofya/base/SConstants.html#SIG_CHKALIVE">SIG_CHKALIVE</A>, <A HREF="../../../sofya/base/SConstants.html#SIG_ECHO">SIG_ECHO</A></CODE></TD>
</TR>
</TABLE>
&nbsp;
<!-- ======== CONSTRUCTOR SUMMARY ======== -->

<A NAME="constructor_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Constructor Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected </CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../sofya/ed/structural/SocketProbe.html#SocketProbe(int)">SocketProbe</A></B>(int&nbsp;port)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Standard constructor.</TD>
</TR>
</TABLE>
&nbsp;
<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Method Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../sofya/ed/structural/SocketProbe.html#finish()">finish</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;byte[]</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../sofya/ed/structural/SocketProbe.html#getObjectArray(java.lang.String, int)">getObjectArray</A></B>(java.lang.String&nbsp;mSignature,
               int&nbsp;objCount)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gets the byte array recording which trace objects have been witnessed
 in a given method.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../sofya/ed/structural/SocketProbe.html#markMethodInSequence(java.lang.String, int)">markMethodInSequence</A></B>(java.lang.String&nbsp;mSignature,
                     int&nbsp;objCount)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Inserts a new method marker and index into the sequence array.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../sofya/ed/structural/SocketProbe.html#run()">run</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Runs the (daemon) thread.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../sofya/ed/structural/SocketProbe.html#start(int, int, boolean, boolean, int)">start</A></B>(int&nbsp;port,
      int&nbsp;_instMode,
      boolean&nbsp;_doTimestamps,
      boolean&nbsp;_useSignalSocket,
      int&nbsp;_objType)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Creates SocketProbe and starts daemon thread to keep it memory resident.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../sofya/ed/structural/SocketProbe.html#writeObjectCount(java.lang.String, int)">writeObjectCount</A></B>(java.lang.String&nbsp;mSignature,
                 int&nbsp;objCount)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Writes the number of objects (trace entities) in the current method to
 the socket so that the event dispatcher can notify listeners.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../sofya/ed/structural/SocketProbe.html#writeSequenceData()">writeSequenceData</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Writes the current contents of the object sequence array to the socket
 to be relayed to listeners by the event dispatcher.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../sofya/ed/structural/SocketProbe.html#writeTraceMessage(int, java.lang.String)">writeTraceMessage</A></B>(int&nbsp;bId,
                  java.lang.String&nbsp;mSignature)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Transmits a trace message to the event dispatcher via the socket.</TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Methods inherited from class java.lang.Object</B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ============ FIELD DETAIL =========== -->

<A NAME="field_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Field Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="NEW_METHOD_MARKER"><!-- --></A><H3>
NEW_METHOD_MARKER</H3>
<PRE>
protected static final int <B>NEW_METHOD_MARKER</B></PRE>
<DL>
<DD>Constant which marks that the next element in the object
        sequence array contains the index to a new method signature.
<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../../constant-values.html#sofya.ed.structural.SocketProbe.NEW_METHOD_MARKER">Constant Field Values</A></DL>
</DL>
<HR>

<A NAME="BRANCH_EXIT_MARKER"><!-- --></A><H3>
BRANCH_EXIT_MARKER</H3>
<PRE>
protected static final int <B>BRANCH_EXIT_MARKER</B></PRE>
<DL>
<DD>Constant which marks in the sequence array that the current
        method is exiting.
<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../../constant-values.html#sofya.ed.structural.SocketProbe.BRANCH_EXIT_MARKER">Constant Field Values</A></DL>
</DL>
<HR>

<A NAME="sequenceArray"><!-- --></A><H3>
sequenceArray</H3>
<PRE>
public static int[] <B>sequenceArray</B></PRE>
<DL>
<DD>Array which stores the hit object IDs sequentially, using
        special marker/index pairs to indicate entry into new methods.
        It is public so that the instrumentation is not required
        to make a method call to retrieve a reference to it.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="sequenceIndex"><!-- --></A><H3>
sequenceIndex</H3>
<PRE>
public static int <B>sequenceIndex</B></PRE>
<DL>
<DD>Index pointing to the next open entry in the sequence array.
        Instrumentation is responsible for updating this pointer when
        recording an object ID, and calling
        <code>writeSequenceData</code> when the array is filled.
<P>
<DL>
</DL>
</DL>

<!-- ========= CONSTRUCTOR DETAIL ======== -->

<A NAME="constructor_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Constructor Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="SocketProbe(int)"><!-- --></A><H3>
SocketProbe</H3>
<PRE>
protected <B>SocketProbe</B>(int&nbsp;port)</PRE>
<DL>
<DD>Standard constructor.

 <p>Attempts to open the static socket used to send trace messages to the
 event dispatcher. This constructor should be called by
 <A HREF="../../../sofya/ed/structural/SocketProbe.html#start(int, int, boolean, boolean, int)"><CODE>start(int, int, boolean, boolean, int)</CODE></A>, which will be invoked by the subject with the
 port number embedded by the <A HREF="../../../sofya/ed/Instrumentor.html" title="class in sofya.ed"><CODE>Instrumentor</CODE></A>. Naturally, if
 the subject is instrumented on a different port than the event dispatcher
 is listening on, this action will fail. If the connection cannot be made,
 the system exits (an action which will occur before any subject code
 is executed).</p>
<P>
<DL>
<DT><B>Parameters:</B><DD><CODE>port</CODE> - Port number to be used to connect the socket. This should
 be set by the instrumentor and supplied by the subject via a call to
 <A HREF="../../../sofya/ed/structural/SocketProbe.html#start(int, int, boolean, boolean, int)"><CODE>start(int, int, boolean, boolean, int)</CODE></A>.</DL>
</DL>

<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Method Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="start(int, int, boolean, boolean, int)"><!-- --></A><H3>
start</H3>
<PRE>
public static void <B>start</B>(int&nbsp;port,
                         int&nbsp;_instMode,
                         boolean&nbsp;_doTimestamps,
                         boolean&nbsp;_useSignalSocket,
                         int&nbsp;_objType)</PRE>
<DL>
<DD>Creates SocketProbe and starts daemon thread to keep it memory resident.

 <p>Creates an instance of the SocketProbe connected to the specified
 port. Once the SocketProbe is created it is executed in a daemon thread.
 This guarantees that the same SocketProbe object will handle all
 instrumentation and ensures that the underlying socket remains
 persistent. It is run as a daemon thread to ensure that it is terminated
 automatically when the subject is finished. The thread itself does not
 take any action (See <A HREF="../../../sofya/ed/structural/SocketProbe.html#run()"><CODE>run()</CODE></A>). If this method has
 already been called by the current subject, it returns immediately
 without taking any action.</p>

 <p>The <A HREF="../../../sofya/ed/Instrumentor.html" title="class in sofya.ed"><CODE>Instrumentor</CODE></A> should guarantee that a call
 to this method is inserted into the subject class as the first possible
 executable statement in the class, either in the static initializer
 (<i>&lt;clinit&gt;</i>) or in <i>main</i>. This will ensure that all
 instrumentation is sent correctly. If SocketProbe itself is instrumented,
 a call to this method on SocketProbeAlt (the clone of the invoking
 filter's SocketProbe, see <A HREF="../../../sofya/ed/structural/ProgramEventDispatcher.html" title="class in sofya.ed.structural"><CODE>ProgramEventDispatcher</CODE></A>) will be
 inserted in its static initializer, which allows the SocketProbe to be
 traced without introducing infinite recursion scenarios.</p>

 <p>If the subject being run is an event dispacher, the subject
 dispatcher's SocketProbe will be running in its own subject's JVM. As a
 result, to trace the SocketProbe (logically considered a component of the
 subject event dispatcher), the main invoking dispatcher will need to
 accept two instrumentation connections, one from the subject event
 dispatcher and one from the SocketProbe. This requires it to synchronize
 the trace messages it receives. To make this possible, the
 <code>doTimestamping</code> flag should be set by the instrumentor, which
 will cause the SocketProbe to insert timestamps at the front of each
 trace message, which can then be used by the event dispatcher to
 order the trace messages. Under no other circumstance should this flag
 be set. (See <A HREF="../../../sofya/ed/structural/ProgramEventDispatcher.html" title="class in sofya.ed.structural"><CODE>ProgramEventDispatcher</CODE></A>).</p>

 <p>All parameters should be set by the instrumentor.</p>
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>port</CODE> - Port number to be used to connect the socket.<DD><CODE>_instMode</CODE> - Integer flag specifying the type of instrumentation
 present in the subject.<DD><CODE>_doTimestamps</CODE> - Flag indicating whether trace messages are to be
 timestamped. This is only used with the subject is an event dispatcher.<DD><CODE>_useSignalSocket</CODE> - Flag indicating whether a signal socket
 connection should be made to the event dispatcher. This is only used
 when the subject is an event dispatcher.<DD><CODE>_objType</CODE> - Integer flag specifying the type of program entity
 traced by the instrumentation present in the subject.</DL>
</DD>
</DL>
<HR>

<A NAME="finish()"><!-- --></A><H3>
finish</H3>
<PRE>
public static void <B>finish</B>()</PRE>
<DL>
<DD><DL>
</DL>
</DD>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="run()"><!-- --></A><H3>
run</H3>
<PRE>
public void <B>run</B>()</PRE>
<DL>
<DD>Runs the (daemon) thread.

 <p>The run method simply sleeps indefinitely, so as to keep the same
 instance of the SocketProbe alive. Note that the run method is
 uninterruptable. Instead, since it is running as a daemon thread, it
 will die automatically when the subject exits.</p>
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE>run</CODE> in interface <CODE>java.lang.Runnable</CODE></DL>
</DD>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="writeTraceMessage(int, java.lang.String)"><!-- --></A><H3>
writeTraceMessage</H3>
<PRE>
public static void <B>writeTraceMessage</B>(int&nbsp;bId,
                                     java.lang.String&nbsp;mSignature)</PRE>
<DL>
<DD>Transmits a trace message to the event dispatcher via the socket.

 <p>The correct port should be set by <A HREF="../../../sofya/ed/structural/SocketProbe.html#start(int, int, boolean, boolean, int)"><CODE>start(int, int, boolean, boolean, int)</CODE></A> and thus
 will be known internally as part of the state of the SocketProbe
 object. Since the SocketProbe object is kept resident by the daemon
 thread, any class throughout the subject can call this method and
 successfully transmit a message, assuming <A HREF="../../../sofya/ed/structural/SocketProbe.html#start(int, int, boolean, boolean, int)"><CODE>start(int, int, boolean, boolean, int)</CODE></A>
 has been called previously.</p>

 <p>A single threaded subject can only call this method sequentially,
 resulting in typical in-order processing of trace statements.
 Multithreaded subjects, however, may call this method from
 different threads, in which case the order of processing of
 trace statements is not guaranteed to be deterministic.
 The actual transmission of the message through the socket is
 synchronized, however, ensuring that the message will not
 be corrupted.</p>

 <p>This method will not block unless the buffer of the underlying
 socket has been filled.</p>
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>bId</CODE> - The ID of the trace object marked by this instrumentation
 probe.<DD><CODE>mSignature</CODE> - Full signature of the method which contains
 the trace object being marked.</DL>
</DD>
</DL>
<HR>

<A NAME="getObjectArray(java.lang.String, int)"><!-- --></A><H3>
getObjectArray</H3>
<PRE>
public static byte[] <B>getObjectArray</B>(java.lang.String&nbsp;mSignature,
                                    int&nbsp;objCount)</PRE>
<DL>
<DD>Gets the byte array recording which trace objects have been witnessed
 in a given method.

 <p>If this is the first time the method has been traced (or the
 method has been removed from the cache), an array of the necessary
 size is allocated and initialized. Calls to this method are
 inserted at the beginning of methods in the subject by the
 instrumentor.</p>
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>mSignature</CODE> - Signature of the method for which the byte array
 is to be retrieved. The signature guarantees uniqueness.<DD><CODE>objCount</CODE> - Number of trace objects in the method, used only
 when the array must be allocated. This value should be determined
 by the CFG builder and set by the instrumentor.
<DT><B>Returns:</B><DD>The byte array recording trace objects witnessed in the
 method.</DL>
</DD>
</DL>
<HR>

<A NAME="markMethodInSequence(java.lang.String, int)"><!-- --></A><H3>
markMethodInSequence</H3>
<PRE>
public static void <B>markMethodInSequence</B>(java.lang.String&nbsp;mSignature,
                                        int&nbsp;objCount)</PRE>
<DL>
<DD>Inserts a new method marker and index into the sequence array.

 <p>A map is checked to see if an index has already been created for
 the given signature string. If it has, the existing index is
 retrieved, otherwise a new index is created and added. A new
 method marker is then inserted, followed by the index to the
 signature string. The index pointer is advanced by two so that
 it is left pointing to the next open element in the array.
 If advancing the pointer two elements will exceed the size of
 the array, the array is first committed to the trace and the
 pointer is reset to zero before proceeding.</p>
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>mSignature</CODE> - Signature of the method which has been entered
 and needs to be marked in the array.<DD><CODE>objCount</CODE> - Number of trace objects in the method.</DL>
</DD>
</DL>
<HR>

<A NAME="writeSequenceData()"><!-- --></A><H3>
writeSequenceData</H3>
<PRE>
public static void <B>writeSequenceData</B>()</PRE>
<DL>
<DD>Writes the current contents of the object sequence array to the socket
 to be relayed to listeners by the event dispatcher.

 <p>New-method markers are used to transmit object IDs in a series
 of chunks associated with the correct method signature string.
 If the array begins with a continuation of object IDs for a method
 from the previous contents of the array, the
 <code>currentMethodSig</code> field is used to properly associate
 the objects with that method. When this method returns, all of the
 object IDs currently in the array will have been transmitted to the
 filter and the array index pointer reset to zero.</p>
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="writeObjectCount(java.lang.String, int)"><!-- --></A><H3>
writeObjectCount</H3>
<PRE>
public static void <B>writeObjectCount</B>(java.lang.String&nbsp;mSignature,
                                    int&nbsp;objCount)</PRE>
<DL>
<DD>Writes the number of objects (trace entities) in the current method to
 the socket so that the event dispatcher can notify listeners.
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>mSignature</CODE> - Signature of the method for which the object count
 is being sent.<DD><CODE>objCount</CODE> - Number of objects in the method.</DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../sofya/ed/structural/SequenceTraceWriter.html" title="class in sofya.ed.structural"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../sofya/ed/structural/SocketProcessingStrategy.html" title="interface in sofya.ed.structural"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../index.html?sofya/ed/structural/SocketProbe.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="SocketProbe.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>

</BODY>
</HTML>
